<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <title>NHÓM 3 VIPPRO</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <style>
        body, html { margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; height: 100%; }
        #map { width: 100%; height: 85vh; } /* Tăng diện tích bản đồ */
        
        .aqi-marker {
            display: flex; align-items: center; justify-content: center;
            border-radius: 50%; color: white; font-weight: bold;
            border: 2px solid white; width: 32px; height: 32px;
            box-shadow: 0 0 10px rgba(0,0,0,0.5);
            animation: pulse-marker 2s infinite ease-in-out;
            cursor: pointer;
        }
        @keyframes pulse-marker {
            0% { transform: scale(1); box-shadow: 0 0 0 0 rgba(255,255,255,0.7); }
            50% { transform: scale(1.2); box-shadow: 0 0 0 10px rgba(255,255,255,0); }
            100% { transform: scale(1); }
        }
    </style>
</head>
<body>

    <div style="padding: 12px; background: #d32f2f; color: white; text-align: center; cursor: pointer; font-weight: bold;" 
         onclick="toggleNews()">
        CHẠM ĐỂ XEM THỰC TRẠNG Ô NHIỄM KHÔNG KHÍ
    </div>

    <div id="newsSection" style="display: none; padding: 20px; background: #fff5f5; border-bottom: 3px solid #d32f2f;">
        <h2 style="color: #d32f2f; text-transform: uppercase; margin-top: 0;">Khi con người là cỗ máy thở chạy hết công suất</h2>
        <p style="font-size: 16px; line-height: 1.6; color: #333;">
            <b>MỚI NHẤT:</b> Ô nhiễm không khí sáng nay 11/12/2025 ở Hà Nội lên ngưỡng tím, chỉ số IQAir ở mức <b>244</b> lên top 1 thế giới về ô nhiễm không khí, rất nguy hiểm cho sức khỏe. Tại trạm Đại học Bách khoa là 227, ở mức rất xấu.
        </p>
    </div>

    <div id="map"></div>

    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script>
        // Khởi tạo bản đồ tập trung vào Việt Nam
        var map = L.map('map').setView([16.5, 110.0], 5); 

        // Lớp bản đồ Google Maps tiếng Việt - Khẳng định chủ quyền không cần Marker AQI
        L.tileLayer('https://{s}.google.com/vt/lyrs=m&x={x}&y={y}&z={z}', {
            maxZoom: 20,
            subdomains: ['mt0', 'mt1', 'mt2', 'mt3'],
            attribution: 'Hoàng Sa và Trường Sa là của Việt Nam'
        }).addTo(map);

        function toggleNews() {
            var x = document.getElementById("newsSection");
            x.style.display = (x.style.display === "none") ? "block" : "none";
        }

        // CHỈ GIỮ LẠI 6 THÀNH PHỐ ĐỂ SO SÁNH
        var danhSachAQI = [
            { ten: "TP. Hà Nội", toaDo: [21.0285, 105.8542], chiSo: 244, danhGia: "Rất xấu", nguyenNhan: "7 triệu xe xả thải & hiện tượng nghịch nhiệt mùa đông." },
            { ten: "TP. Hải Phòng", toaDo: [20.8449, 106.6881], chiSo: 131, danhGia: "Kém", nguyenNhan: "Phát thải công nghiệp nặng và bụi vận tải cảng biển." },
            { ten: "TP. Đà Nẵng", toaDo: [16.0544, 108.2022], chiSo: 63, danhGia: "Trung bình", nguyenNhan: "Lưu lượng xe tăng nhưng có gió biển điều hòa tốt." },
            { ten: "TP. Huế", toaDo: [16.4637, 107.5908], chiSo: 58, danhGia: "Trung bình", nguyenNhan: "Mật độ cây xanh cao, ít cơ sở phát thải nặng." },
            { ten: "TP. Hồ Chí Minh", toaDo: [10.7626, 106.6601], chiSo: 84, danhGia: "Trung bình", nguyenNhan: "Ùn tắc cửa ngõ và khói thải từ lượng xe cá nhân khổng lồ." },
            { ten: "TP. Cần Thơ", toaDo: [10.0333, 105.7833], chiSo: 67, danhGia: "Trung bình", nguyenNhan: "Hệ thống sông ngòi giúp khuếch tán bụi mịn hiệu quả." }
        ];

        function getColor(aqi) {
            if (aqi > 200) return "#8c1aff"; // Tím
            if (aqi > 150) return "#ff4d4d"; // Đỏ
            if (aqi > 100) return "#f49633"; // Cam
            if (aqi > 50) return "#ffeb3b";  // Vàng}
        }
        danhSachAQI.forEach(function(tinh) {
            var mauSac = getColor(tinh.chiSo);

            var iconAQI = L.divIcon({
                className: '',
                html: `<div class="aqi-marker" style="background-color: ${mauSac}">${tinh.chiSo}</div>`,
                iconSize: [32, 32], iconAnchor: [16, 16]
            });

            L.marker(tinh.toaDo, {icon: iconAQI})
                .addTo(map)
                .bindPopup(`
                    <div style="text-align: center; width: 180px;">
                        <b>${tinh.ten}</b><br>
                        <span style="font-size: 20px; color: ${mauSac}; font-weight: bold;">AQI: ${tinh.chiSo}</span><br>
                        <div style="background:${mauSac}; color:white; padding:2px; border-radius:3px;">${tinh.danhGia}</div>
                        <p style="font-size:12px; text-align:left; margin-top:5px;"><b>Nguyên nhân:</b> ${tinh.nguyenNhan}</p>
                    </div>
                `);
        });
    </script>
</body>
</html>